#!/bin/bash

TERMUX_UTILS=$(realpath $(dirname ${BASH_SOURCE[0]}))


export USER_SCRIPTS=$HOME/.local/bin
export PATH=$USER_SCRIPTS:$PATH


# These will affect the loading of some things.
if ! [[ -f "$HOME/.termux_env_tweaks" ]];
then
    touch "$HOME/.termux_env_tweaks"
fi

source "$HOME/.termux_env_tweaks"

echo "Loaded tweaks for Termux environment, if any."
echo ""


if [[ -f "$PREFIX/bin/proot-distro" ]] && [[ -v ENABLE_PROOTS ]];
then
    source "$TERMUX_UTILS/proots/.proots_env"
fi


if [[ -f "$PREFIX/bin/termux-x11" ]] && [[ -v ENABLE_X11 ]];
then
    source "$TERMUX_UTILS/x11/.x11_env"
fi


if [[ -f "$PREFIX/bin/pulseaudio" ]] && [[ -v ENABLE_AUDIO ]];
then
    source "$TERMUX_UTILS/x11/.audio_env"
fi


if [[ -f "$PREFIX/bin/fluidsynth" ]] && [[ -v ENABLE_MIDI ]];
then
    source "$TERMUX_UTILS/x11/midi_support/.midi_env"
fi


if [[ -f "$PREFIX/bin/virgl_test_server_android" ]] && [[ -v ENABLE_3D ]];
then
    source "$TERMUX_UTILS/x11/.3d_env"
fi


# Your own config
if [[ -f "$HOME/.user_env" ]] && ! [[ -v DISABLE_USER_ENV ]];
then
    source "$HOME/.user_env"

    echo "Loaded user environment."
    echo ""
fi


echo "Finished loading Termux environment."
echo ""
echo "If want to enable a functionality at startup, add one of more of"
echo "these to the ~/.termux_env_tweaks file."
echo ""
echo "- export ENABLE_PROOTS=1"
echo "- export ENABLE_X11=1"
echo "- export ENABLE_MIDI=1"
echo "- export ENABLE_3D=1"
echo ""
